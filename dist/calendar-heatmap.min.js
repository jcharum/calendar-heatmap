"use strict";define(["d3","moment"],function(t,e){var n={settings:{gutter:5,item_gutter:1,width:1e3,height:200,item_size:10,label_padding:40,max_block_height:20,transition_duration:500,tooltip_width:250,tooltip_padding:15},init:function(t,e,i,a){n.data=t,n.color=e||"#ff4500",n.overview=i||"global",n.history=["global"],n.selected={},n.handler=a,n.in_transition=!1,n.createElements(),n.parseData(),n.drawChart()},createElements:function(){var i=document.createElement("div");i.className="calendar-heatmap",document.body.appendChild(i);var a=t.select(i).append("svg").attr("class","svg");n.items=a.append("g"),n.labels=a.append("g"),n.buttons=a.append("g"),n.tooltip=t.select(i).append("div").attr("class","heatmap-tooltip").style("opacity",0);var r=function(){var t=Math.round((e()-e().subtract(1,"year").startOf("week"))/864e5),r=Math.trunc(t/7),s=r+1;n.settings.width=i.offsetWidth<1e3?1e3:i.offsetWidth,n.settings.item_size=(n.settings.width-n.settings.label_padding)/s-n.settings.gutter,n.settings.height=n.settings.label_padding+7*(n.settings.item_size+n.settings.gutter),a.attr("width",n.settings.width).attr("height",n.settings.height),n.data&&n.data[0].summary&&n.drawChart()};r(),window.onresize=function(t){r()}},parseData:function(){n.data&&(n.data[0].summary||n.data.map(function(t){var e=t.details.reduce(function(t,e){return t[e.name]?t[e.name].value+=e.value:t[e.name]={value:e.value},t},{}),n=Object.keys(e).map(function(t){return{name:t,value:e[t].value}});return t.summary=n.sort(function(t,e){return e.value-t.value}),t}))},drawChart:function(){"global"===n.overview?n.drawGlobalOverview():"year"===n.overview?n.drawYearOverview():"month"===n.overview?n.drawMonthOverview():"week"===n.overview?n.drawWeekOverview():"day"===n.overview&&n.drawDayOverview()},drawGlobalOverview:function(){n.history[n.history.length-1]!==n.overview&&n.history.push(n.overview);var i=e(n.data[0].date).startOf("year"),a=e(n.data[n.data.length-1].date).endOf("year"),r=t.timeYears(i,a).map(function(t){var i=e(t);return{date:i,total:n.data.reduce(function(t,n){return e(n.date).year()===i.year()&&(t+=n.total),t},0),summary:function(){var t=n.data.reduce(function(t,n){if(e(n.date).year()===i.year())for(var a=0;a<n.summary.length;a++)t[n.summary[a].name]?t[n.summary[a].name].value+=n.summary[a].value:t[n.summary[a].name]={value:n.summary[a].value};return t},{}),a=Object.keys(t).map(function(e){return{name:e,value:t[e].value}});return a.sort(function(t,e){return e.value-t.value})}()}}),s=t.max(r,function(t){return t.total}),o=t.timeYears(i,a).map(function(t){return e(t)}),l=t.scaleBand().rangeRound([0,n.settings.width]).padding([.05]).domain(o.map(function(t){return t.year()}));n.items.selectAll(".item-block-year").remove();n.items.selectAll(".item-block-year").data(r).enter().append("rect").attr("class","item item-block-year").attr("width",function(){return(n.settings.width-n.settings.label_padding)/o.length-5*n.settings.gutter}).attr("height",function(){return n.settings.height-n.settings.label_padding}).attr("transform",function(t){return"translate("+l(t.date.year())+","+2*n.settings.tooltip_padding+")"}).attr("fill",function(e){var i=t.scaleLinear().range(["#ffffff",n.color||"#ff4500"]).domain([-.15*s,s]);return i(e.total)||"#ff4500"}).on("click",function(t){n.in_transition||(n.in_transition=!0,n.selected=t,n.hideTooltip(),n.removeGlobalOverview(),n.overview="year",n.drawChart())}).style("opacity",0).on("mouseover",function(e){if(!n.in_transition){var i="";i+="<div><span><strong>Total time tracked:</strong></span>";var a=parseInt(e.total,10),r=Math.floor(a/86400);r>0&&(i+="<span>"+(1===r?"1 day":r+" days")+"</span></div>");var s=Math.floor((a-86400*r)/3600);s>0&&(i+=r>0?"<div><span></span><span>"+(1===s?"1 hour":s+" hours")+"</span></div>":"<span>"+(1===s?"1 hour":s+" hours")+"</span></div>");var o=Math.floor((a-86400*r-3600*s)/60);if(o>0&&(i+=r>0||s>0?"<div><span></span><span>"+(1===o?"1 minute":o+" minutes")+"</span></div>":"<span>"+(1===o?"1 minute":o+" minutes")+"</span></div>"),i+="<br />",e.summary.length<=5)for(var d=0;d<e.summary.length;d++)i+="<div><span><strong>"+e.summary[d].name+"</strong></span>",i+="<span>"+n.formatTime(e.summary[d].value)+"</span></div>";else{for(var d=0;d<5;d++)i+="<div><span><strong>"+e.summary[d].name+"</strong></span>",i+="<span>"+n.formatTime(e.summary[d].value)+"</span></div>";i+="<br />";for(var u=0,d=5;d<e.summary.length;d++)u=+e.summary[d].value;i+="<div><span><strong>Other:</strong></span>",i+="<span>"+n.formatTime(u)+"</span></div>"}for(var c=l(e.date.year())+2*n.settings.tooltip_padding;n.settings.width-c<n.settings.tooltip_width+5*n.settings.tooltip_padding;)c-=10;var m=3*n.settings.tooltip_padding;n.tooltip.html(i).style("left",c+"px").style("top",m+"px").transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",1)}}).on("mouseout",function(){n.in_transition||n.hideTooltip()}).transition().delay(function(t,e){return n.settings.transition_duration*(e+1)/10}).duration(function(){return n.settings.transition_duration}).ease(t.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){n.in_transition=!1});n.labels.selectAll(".label-year").remove(),n.labels.selectAll(".label-year").data(o).enter().append("text").attr("class","label label-year").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return t.year()}).attr("x",function(t){return l(t.year())}).attr("y",n.settings.label_padding/2).on("mouseenter",function(i){n.in_transition||n.items.selectAll(".item-block-year").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).year()===i.year()?1:.1})}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block-year").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}).on("click",function(t){n.in_transition||(n.in_transition=!0,n.selected={date:t},n.hideTooltip(),n.removeGlobalOverview(),n.overview="year",n.drawChart())})},drawYearOverview:function(){n.history[n.history.length-1]!==n.overview&&n.history.push(n.overview);var i=e(n.selected.date).startOf("year"),a=e(n.selected.date).endOf("year"),r=n.data.filter(function(t){return i<=e(t.date)&&e(t.date)<a}),s=t.max(r,function(t){return t.total}),o=t.scaleLinear().range(["#ffffff",n.color||"#ff4500"]).domain([-.15*s,s]),l=function(t){var a=e(t.date),r=Math.round((a-e(i).startOf("week"))/864e5),s=Math.trunc(r/7);return s*(n.settings.item_size+n.settings.gutter)+n.settings.label_padding},d=function(t){return n.settings.label_padding+e(t.date).weekday()*(n.settings.item_size+n.settings.gutter)},u=function(t){return s<=0?n.settings.item_size:.75*n.settings.item_size+n.settings.item_size*t.total/s*.25};n.items.selectAll(".item-circle").remove(),n.items.selectAll(".item-circle").data(r).enter().append("rect").attr("class","item item-circle").style("opacity",0).attr("x",function(t){return l(t)+(n.settings.item_size-u(t))/2}).attr("y",function(t){return d(t)+(n.settings.item_size-u(t))/2}).attr("rx",function(t){return u(t)}).attr("ry",function(t){return u(t)}).attr("width",function(t){return u(t)}).attr("height",function(t){return u(t)}).attr("fill",function(t){return t.total>0?o(t.total):"transparent"}).on("click",function(t){n.in_transition||0!==t.total&&(n.in_transition=!0,n.selected=t,n.hideTooltip(),n.removeYearOverview(),n.overview="day",n.drawChart())}).on("mouseover",function(i){if(!n.in_transition){var a=t.select(this);!function m(){a=a.transition().duration(n.settings.transition_duration).ease(t.easeLinear).attr("x",function(t){return l(t)-(1.1*n.settings.item_size-n.settings.item_size)/2}).attr("y",function(t){return d(t)-(1.1*n.settings.item_size-n.settings.item_size)/2}).attr("width",1.1*n.settings.item_size).attr("height",1.1*n.settings.item_size).transition().duration(n.settings.transition_duration).ease(t.easeLinear).attr("x",function(t){return l(t)+(n.settings.item_size-u(t))/2}).attr("y",function(t){return d(t)+(n.settings.item_size-u(t))/2}).attr("width",function(t){return u(t)}).attr("height",function(t){return u(t)}).on("end",m)}();var r="";r+='<div class="header"><strong>'+(i.total?n.formatTime(i.total):"No time")+" tracked</strong></div>",r+="<div>on "+e(i.date).format("dddd, MMM Do YYYY")+"</div><br>";for(var s=0;s<i.summary.length;s++)r+="<div><span><strong>"+i.summary[s].name+"</strong></span>",r+="<span>"+n.formatTime(i.summary[s].value)+"</span></div>";var o=l(i)+n.settings.item_size;n.settings.width-o<n.settings.tooltip_width+3*n.settings.tooltip_padding&&(o-=n.settings.tooltip_width+2*n.settings.tooltip_padding);var c=d(i)+n.settings.item_size;n.tooltip.html(r).style("left",o+"px").style("top",c+"px").transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",1)}}).on("mouseout",function(){n.in_transition||(t.select(this).transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).attr("x",function(t){return l(t)+(n.settings.item_size-u(t))/2}).attr("y",function(t){return d(t)+(n.settings.item_size-u(t))/2}).attr("width",function(t){return u(t)}).attr("height",function(t){return u(t)}),n.hideTooltip())}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*n.settings.transition_duration}).duration(function(){return n.settings.transition_duration}).ease(t.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){n.in_transition=!1});var c=t.timeMonths(i,a),m=t.scaleLinear().range([0,n.settings.width]).domain([0,c.length]);n.labels.selectAll(".label-month").remove(),n.labels.selectAll(".label-month").data(c).enter().append("text").attr("class","label label-month").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return t.toLocaleDateString("en-us",{month:"short"})}).attr("x",function(t,e){return m(e)+(m(e)-m(e-1))/2}).attr("y",n.settings.label_padding/2).on("mouseenter",function(i){if(!n.in_transition){var a=e(i);n.items.selectAll(".item-circle").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).isSame(a,"month")?1:.1})}}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-circle").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}).on("click",function(t){if(!n.in_transition){var i=n.data.filter(function(n){return e(t).startOf("month")<=e(n.date)&&e(n.date)<e(t).endOf("month")});i.length&&(n.selected={date:t},n.in_transition=!0,n.hideTooltip(),n.removeYearOverview(),n.overview="month",n.drawChart())}});var f=t.timeDays(e().startOf("week"),e().endOf("week")),g=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.height]).domain(f.map(function(t){return e(t).weekday()}));n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-day").data(f).enter().append("text").attr("class","label label-day").attr("x",n.settings.label_padding/3).attr("y",function(t,e){return g(e)+g.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return e(t).format("dddd")[0]}).on("mouseenter",function(i){if(!n.in_transition){var a=e(i);n.items.selectAll(".item-circle").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).day()===a.day()?1:.1})}}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-circle").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}),n.drawButton()},drawMonthOverview:function(){n.history[n.history.length-1]!==n.overview&&n.history.push(n.overview);for(var i=e(n.selected.date).startOf("month"),a=e(n.selected.date).endOf("month"),r=n.data.filter(function(t){return i<=e(t.date)&&e(t.date)<a}),s=t.max(r,function(e){return t.max(e.summary,function(t){return t.value})}),o=t.timeDays(e().startOf("week"),e().endOf("week")),l=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.height]).domain(o.map(function(t){return e(t).weekday()})),d=[i.clone()];i.week()!==a.week();)d.push(i.add(1,"week").clone());var u=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.width]).padding([.05]).domain(d.map(function(t){return t.week()}));n.items.selectAll(".item-block-month").remove();var c=n.items.selectAll(".item-block-month").data(r).enter().append("g").attr("class","item item-block-month").attr("width",function(){return(n.settings.width-n.settings.label_padding)/d.length-5*n.settings.gutter}).attr("height",function(){return Math.min(l.bandwidth(),n.settings.max_block_height)}).attr("transform",function(t){return"translate("+u(e(t.date).week())+","+(l(e(t.date).weekday())+l.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(t){n.in_transition||0!==t.total&&(n.in_transition=!0,n.selected=t,n.hideTooltip(),n.removeMonthOverview(),n.overview="day",n.drawChart())}),m=(n.settings.width-n.settings.label_padding)/d.length-5*n.settings.gutter,f=t.scaleLinear().rangeRound([0,m]);c.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(e){var n=parseInt(t.select(this.parentNode).attr("total")),i=parseInt(t.select(this.parentNode).attr("offset"));return f.domain([0,n]),t.select(this.parentNode).attr("offset",i+f(e.value)),i}).attr("width",function(e){var i=parseInt(t.select(this.parentNode).attr("total"));return f.domain([0,i]),Math.max(f(e.value)-n.settings.item_gutter,1)}).attr("height",function(){return Math.min(l.bandwidth(),n.settings.max_block_height)}).attr("fill",function(e){var i=t.scaleLinear().range(["#ffffff",n.color||"#ff4500"]).domain([-.15*s,s]);return i(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(i){if(!n.in_transition){var a=new Date(t.select(this.parentNode).attr("date")),r="";r+='<div class="header"><strong>'+i.name+"</strong></div><br>",r+="<div><strong>"+(i.value?n.formatTime(i.value):"No time")+" tracked</strong></div>",r+="<div>on "+e(a).format("dddd, MMM Do YYYY")+"</div>";for(var s=u(e(a).week())+n.settings.tooltip_padding;n.settings.width-s<n.settings.tooltip_width+3*n.settings.tooltip_padding;)s-=10;var o=l(e(a).weekday())+2*n.settings.tooltip_padding;n.tooltip.html(r).style("left",s+"px").style("top",o+"px").transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",1)}}).on("mouseout",function(){n.in_transition||n.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*n.settings.transition_duration}).duration(function(){return n.settings.transition_duration}).ease(t.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){n.in_transition=!1}),n.labels.selectAll(".label-week").remove(),n.labels.selectAll(".label-week").data(d).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return u(t.week())}).attr("y",n.settings.label_padding/2).on("mouseenter",function(i){n.in_transition||n.items.selectAll(".item-block-month").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).week()===i.week()?1:.1})}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block-month").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}).on("click",function(t){if(!n.in_transition){var i=n.data.filter(function(n){return t.startOf("week")<=e(n.date)&&e(n.date)<t.endOf("week")});i.length&&(n.in_transition=!0,n.selected={date:t},n.hideTooltip(),n.removeMonthOverview(),n.overview="week",n.drawChart())}}),n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-day").data(o).enter().append("text").attr("class","label label-day").attr("x",n.settings.label_padding/3).attr("y",function(t,e){return l(e)+l.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return e(t).format("dddd")[0]}).on("mouseenter",function(i){if(!n.in_transition){var a=e(i);n.items.selectAll(".item-block-month").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).day()===a.day()?1:.1})}}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block-month").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}),n.drawButton()},drawWeekOverview:function(){n.history[n.history.length-1]!==n.overview&&n.history.push(n.overview);var i=e(n.selected.date).startOf("week"),a=e(n.selected.date).endOf("week"),r=n.data.filter(function(t){return i<=e(t.date)&&e(t.date)<a}),s=t.max(r,function(e){return t.max(e.summary,function(t){return t.value})}),o=t.timeDays(e().startOf("week"),e().endOf("week")),l=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.height]).domain(o.map(function(t){return e(t).weekday()})),d=[i],u=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.width]).padding([.01]).domain(d.map(function(t){return t.week()}));n.items.selectAll(".item-block-week").remove();var c=n.items.selectAll(".item-block-week").data(r).enter().append("g").attr("class","item item-block-week").attr("width",function(){return(n.settings.width-n.settings.label_padding)/d.length-5*n.settings.gutter}).attr("height",function(){return Math.min(l.bandwidth(),n.settings.max_block_height)}).attr("transform",function(t){return"translate("+u(e(t.date).week())+","+(l(e(t.date).weekday())+l.bandwidth()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(t){n.in_transition||0!==t.total&&(n.in_transition=!0,n.selected=t,n.hideTooltip(),n.removeWeekOverview(),n.overview="day",n.drawChart())}),m=(n.settings.width-n.settings.label_padding)/d.length-5*n.settings.gutter,f=t.scaleLinear().rangeRound([0,m]);c.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(e){var n=parseInt(t.select(this.parentNode).attr("total")),i=parseInt(t.select(this.parentNode).attr("offset"));return f.domain([0,n]),t.select(this.parentNode).attr("offset",i+f(e.value)),i}).attr("width",function(e){var i=parseInt(t.select(this.parentNode).attr("total"));return f.domain([0,i]),Math.max(f(e.value)-n.settings.item_gutter,1)}).attr("height",function(){return Math.min(l.bandwidth(),n.settings.max_block_height)}).attr("fill",function(e){var i=t.scaleLinear().range(["#ffffff",n.color||"#ff4500"]).domain([-.15*s,s]);return i(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(i){if(!n.in_transition){var a=new Date(t.select(this.parentNode).attr("date")),r="";r+='<div class="header"><strong>'+i.name+"</strong></div><br>",r+="<div><strong>"+(i.value?n.formatTime(i.value):"No time")+" tracked</strong></div>",r+="<div>on "+e(a).format("dddd, MMM Do YYYY")+"</div>";var s=parseInt(t.select(this.parentNode).attr("total"));f.domain([0,s]);for(var o=parseInt(t.select(this).attr("x"))+f(i.value)/4+n.settings.tooltip_width/4;n.settings.width-o<n.settings.tooltip_width+3*n.settings.tooltip_padding;)o-=10;var d=l(e(a).weekday())+1.5*n.settings.tooltip_padding;n.tooltip.html(r).style("left",o+"px").style("top",d+"px").transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",1)}}).on("mouseout",function(){n.in_transition||n.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*n.settings.transition_duration}).duration(function(){return n.settings.transition_duration}).ease(t.easeLinear).style("opacity",1).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){n.in_transition=!1}),n.labels.selectAll(".label-week").remove(),n.labels.selectAll(".label-week").data(d).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return u(t.week())}).attr("y",n.settings.label_padding/2).on("mouseenter",function(i){n.in_transition||n.items.selectAll(".item-block-week").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).week()===i.week()?1:.1})}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block-week").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}),n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-day").data(o).enter().append("text").attr("class","label label-day").attr("x",n.settings.label_padding/3).attr("y",function(t,e){return l(e)+l.bandwidth()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return e(t).format("dddd")[0]}).on("mouseenter",function(i){if(!n.in_transition){var a=e(i);n.items.selectAll(".item-block-week").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return e(t.date).day()===a.day()?1:.1})}}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block-week").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)}),n.drawButton()},drawDayOverview:function(){n.history[n.history.length-1]!==n.overview&&n.history.push(n.overview),Object.keys(n.selected).length||(n.selected=n.data[n.data.length-1]);var i=n.selected.summary.map(function(t){return t.name}),a=t.scaleBand().rangeRound([n.settings.label_padding,n.settings.height]).domain(i),r=t.scaleTime().range([2*n.settings.label_padding,n.settings.width]).domain([e(n.selected.date).startOf("day"),e(n.selected.date).endOf("day")]);n.items.selectAll(".item-block").remove(),n.items.selectAll(".item-block").data(n.selected.details).enter().append("rect").attr("class","item item-block").attr("x",function(t){return r(e(t.date))}).attr("y",function(t){return a(t.name)+a.bandwidth()/2-15}).attr("width",function(n){var i=r(t.timeSecond.offset(e(n.date),n.value));return Math.max(i-r(e(n.date)),1)}).attr("height",function(){return Math.min(a.bandwidth(),n.settings.max_block_height)}).attr("fill",function(){return n.color||"#ff4500"}).style("opacity",0).on("mouseover",function(i){if(!n.in_transition){var s="";s+='<div class="header"><strong>'+i.name+"</strong><div><br>",s+="<div><strong>"+(i.value?n.formatTime(i.value):"No time")+" tracked</strong></div>",s+="<div>on "+e(i.date).format("dddd, MMM Do YYYY HH:mm")+"</div>";for(var o=100*i.value/86400+r(e(i.date));n.settings.width-o<n.settings.tooltip_width+3*n.settings.tooltip_padding;)o-=10;var l=a(i.name)+a.bandwidth()/2+n.settings.tooltip_padding/2;n.tooltip.html(s).style("left",o+"px").style("top",l+"px").transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",1)}}).on("mouseout",function(){n.in_transition||n.hideTooltip()}).on("click",function(t){n.handler&&"function"==typeof n.handler&&n.handler(t)}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*n.settings.transition_duration}).duration(function(){return n.settings.transition_duration}).ease(t.easeLinear).style("opacity",.5).call(function(t,e){t.empty()&&e();var n=0;t.each(function(){++n}).on("end",function(){--n||e.apply(this,arguments)})},function(){n.in_transition=!1});var s=t.timeHours(e(n.selected.date).startOf("day"),e(n.selected.date).endOf("day")),o=t.scaleTime().range([2*n.settings.label_padding,n.settings.width]).domain([0,s.length]);n.labels.selectAll(".label-time").remove(),n.labels.selectAll(".label-time").data(s).enter().append("text").attr("class","label label-time").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return e(t).format("HH:mm")}).attr("x",function(t,e){return o(e)}).attr("y",n.settings.label_padding/2).on("mouseenter",function(i){if(!n.in_transition){var a=r(e(i));n.items.selectAll(".item-block").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){var n=r(e(t.date)),i=r(e(t.date).add(t.value,"seconds"));return a>=n&&a<=i?1:.1})}}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",.5)}),n.labels.selectAll(".label-project").remove(),n.labels.selectAll(".label-project").data(i).enter().append("text").attr("class","label label-project").attr("x",n.settings.gutter).attr("y",function(t){return a(t)+a.bandwidth()/2}).attr("min-height",function(){return a.bandwidth()}).style("text-anchor","left").attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).text(function(t){return t}).each(function(){for(var e=t.select(this),i=e.node().getComputedTextLength(),a=e.text();i>1.5*n.settings.label_padding&&a.length>0;)a=a.slice(0,-1),e.text(a+"..."),i=e.node().getComputedTextLength()}).on("mouseenter",function(e){n.in_transition||n.items.selectAll(".item-block").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",function(t){return t.name===e?1:.1})}).on("mouseout",function(){n.in_transition||n.items.selectAll(".item-block").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",.5)}),n.drawButton()},drawButton:function(){n.buttons.selectAll(".button").remove();var e=n.buttons.append("g").attr("class","button button-back").style("opacity",0).on("click",function(){n.in_transition||(n.in_transition=!0,"year"===n.overview?n.removeYearOverview():"month"===n.overview?n.removeMonthOverview():"week"===n.overview?n.removeWeekOverview():"day"===n.overview&&n.removeDayOverview(),n.history.pop(),n.overview=n.history.pop(),n.drawChart())});e.append("circle").attr("cx",n.settings.label_padding/2.25).attr("cy",n.settings.label_padding/2.5).attr("r",n.settings.item_size/2),e.append("text").attr("x",n.settings.label_padding/2.25).attr("y",n.settings.label_padding/2.5).attr("dy",function(){return Math.floor(n.settings.width/100)/3}).attr("font-size",function(){return Math.floor(n.settings.label_padding/3)+"px"}).html("&#x2190;"),e.transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",1)},removeGlobalOverview:function(){n.items.selectAll(".item-block-year").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).remove(),n.labels.selectAll(".label-year").remove()},removeYearOverview:function(){n.items.selectAll(".item-circle").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).remove(),n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-month").remove(),n.hideBackButton()},removeMonthOverview:function(){n.items.selectAll(".item-block-month").selectAll(".item-block-rect").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).attr("x",function(t,e){return e%2===0?-n.settings.width/3:n.settings.width/3}).remove(),n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-week").remove(),n.hideBackButton()},removeWeekOverview:function(){n.items.selectAll(".item-block-week").selectAll(".item-block-rect").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).attr("x",function(t,e){return e%2===0?-n.settings.width/3:n.settings.width/3}).remove(),n.labels.selectAll(".label-day").remove(),n.labels.selectAll(".label-week").remove(),n.hideBackButton()},removeDayOverview:function(){n.items.selectAll(".item-block").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).attr("x",function(t,e){return e%2===0?-n.settings.width/3:n.settings.width/3}).remove(),n.labels.selectAll(".label-time").remove(),n.labels.selectAll(".label-project").remove(),n.hideBackButton()},hideTooltip:function(){n.tooltip.transition().duration(n.settings.transition_duration/2).ease(t.easeLinear).style("opacity",0)},hideBackButton:function(){n.buttons.selectAll(".button").transition().duration(n.settings.transition_duration).ease(t.easeLinear).style("opacity",0).remove()},formatTime:function(t){var e=Math.floor(t/3600),n=Math.floor((t-3600*e)/60),i="";return e>0&&(i+=1===e?"1 hour ":e+" hours "),n>0&&(i+=1===n?"1 minute":n+" minutes"),0===e&&0===n&&(i=Math.round(t)+" seconds"),i}};return n});